Тестовое задание: Реализация CryptApi для API
Описание проекта
Проект представляет собой реализацию Java-класса CryptApi, обеспечивающего взаимодействие с API для создания документов, связанных с вводом в оборот товаров, произведенных в Российской Федерации. Класс разработан с учетом требований задания: потокобезопасность (thread-safety), ограничение количества запросов в заданный интервал времени и поддержка аутентификации с использованием УКЭП. Реализация выполнена на Java 24, с использованием современных практик программирования, минимизацией зависимостей и оптимизацией производительности.
Цели и достижения

Функциональность:

Реализован метод createDocument(Document, String) для отправки документов на эндпоинт /lk/documents/create (предполагаемый для ввода товаров в оборот).
Поддержка двухэтапной аутентификации: получение UUID и данных для подписи (/auth/cert/key) и получение токена (/auth/cert/).
Имитация подписи УКЭП в формате base64 с комментариями для интеграции с CryptoPro JCP.
Возвращение идентификатора документа из ответа API.


Ограничение запросов:

Разработан потокобезопасный RateLimiter на основе алгоритма скользящего окна, ограничивающий количество запросов (например, 10 запросов в секунду).
Использованы ConcurrentLinkedQueue для хранения временных меток и ReentrantLock для синхронизации.


Потокобезопасность:

Управление токенами через AuthTokenManager с использованием ReentrantLock для предотвращения конфликтов в многопоточной среде.
Кэширование токенов с временем жизни 10 часов для минимизации запросов к API аутентификации.
Использование ConcurrentHashMap для кэширования данных аутентификации.


Оптимизация производительности:

Применен встроенный HttpClient Java 24 с поддержкой HTTP/2 и пула соединений для снижения накладных расходов на TLS.
Настроен ObjectMapper (Jackson) для игнорирования неизвестных полей, что повышает устойчивость к изменениям API.
Добавлена поддержка сжатия ответов (Accept-Encoding: gzip) для уменьшения объема передаваемых данных.
Минимизированы внешние зависимости, использованы только Jackson и встроенные библиотеки Java.


Расширяемость:

Использованы record для структур данных (Document, Product, AuthRequest), что упрощает добавление новых полей.
Модульная структура позволяет легко добавлять новые методы API (например, для других типов документов).
Подробные комментарии для интеграции с CryptoPro JCP облегчают внедрение в продакшен.



Использованные технологии

Язык: Java 24
Библиотеки:
HTTP: java.net.http.HttpClient (встроенный) — для выполнения HTTP-запросов с пулом соединений и TLS.
JSON: Jackson (com.fasterxml.jackson.core:jackson-databind:2.17.2) — для сериализации/десериализации JSON.
Криптография: Заглушка для УКЭП с рекомендацией использовать CryptoPro JCP (сертифицированная библиотека для ГОСТ Р 34.10-2012).
Concurrency: Встроенные java.util.concurrent.* (ReentrantLock, ConcurrentLinkedQueue, ConcurrentHashMap) — для потокобезопасности.


